import pandas as pd
from openpyxl import load_workbook
from openpyxl import Workbook

path = "./data-engineering-test/assets/vendas-combustiveis-m3.xlsx"

# libreoffice --invisible --headless --convert-to xlsx vendas-combustiveis-m3.xls --outdir /home/magico/Main/challenge/data-engineering-test/assets/

# https://github.com/pandas-dev/pandas/issues/38956
# leitura formato xls
def open_xlrd(path):
    import xlrd
    wb = xlrd.open_workbook(path)

    # https://xlrd.readthedocs.io/en/latest/
    # print("The number of worksheets is {0}".format(wb.nsheets))
    # print("Worksheet name(s): {0}".format(wb.sheet_names()))
    # sh = wb.sheet_by_index(0)
    # print("{0} {1} {2}".format(sh.name, sh.nrows, sh.ncols))
    # print("Cell D30 is {0}".format(sh.cell_value(rowx=29, colx=3)))
    # for rx in range(sh.nrows):
    #     print(sh.row(rx))

    sheet = wb.sheet_by_index(0)
    data = []
    for i in range(sheet.nrows):
        data.append([value for value in sheet.row_values(i)])
    return data

def extract_xlsx_sheet(file_location,sheet,output_filelocation):
    wb = load_workbook(file_location)
    sheets = wb.sheetnames

    for s in sheets:
        if s != sheet:
            sheet_name = wb.get_sheet_by_name(s)
            wb.remove_sheet(sheet_name)
    
    wb.save(output_filelocation)

extract_xlsx_sheet(path, "DPCache_m3_2", "data.xlsx")

pd.read_excel("./data.xlsx")
